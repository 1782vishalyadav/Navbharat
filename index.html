<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <title>‡§®‡§µ ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§ï‡•ã‡§® - Your Daily News</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="index.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <header>
    <div class="top-bar">
      <span class="date" id="currentDate"></span>
      <span class="tagline">‡§®‡§µ‡•Ä‡§® ‡§µ‡§ø‡§ö‡§æ‡§∞...‡§®‡§µ‡•ç‡§Ø‡§æ ‡§¶‡§ø‡§∂‡§æ! ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§¨‡§æ‡§§‡§Æ‡•Ä | ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§∞‡•ç‡§π ‡§∏‡•ç‡§∞‡•ã‡§§ | ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§Æ‡§§‡•á</span>
      <span class="social-icons">
        <!-- Social icons omitted for brevity -->
      </span>
    </div>
    <div class="logo">üì∞ ‡§®‡§µ ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§ï‡•ã‡§®</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="archive.html">Archive</a>
      <a href="upload.html">Admin</a>
    </nav>
  </header>

  <main>
    <div class="pdf-viewer">
      <iframe id="pdfFrame" width="100%" height="600" style="border:none; border-radius:8px; background:#fff;" allowfullscreen></iframe>
      <embed id="pdfEmbed" type="application/pdf" width="100%" height="600px" style="display:none;" />
      <canvas id="pdfThumb"></canvas>
      <div style="text-align:center; margin-top:12px;">
        <a id="fallbackLink" href="#" target="_blank" rel="noopener">
          PDF ‡§® ‡§â‡§ò‡§°‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§Ø‡•á‡§•‡•á ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ (Click here if PDF does not load)
        </a>
      </div>
    </div>

    <button id="shareBtn" style="margin:16px auto; display:block;">Share Website</button>
    <div id="pdfDetails" style="margin:12px 0; text-align:center; color:#444;"></div>
  </main>

  <footer>
    <div class="footer-content">
      <span>&copy; 2025 ‡§®‡§µ ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§ï‡•ã‡§® | All Rights Reserved.</span>
      <span>Contact: work.vishnumore@gmail.com | ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ï: ‡§µ‡§ø‡§∑‡•ç‡§£‡•Ç ‡§Æ‡•ã‡§∞‡•á</span>
      <span>Developer: Vishal Yadav</span>
    </div>
  </footer>

  <script>
  // Initialize Supabase
  const supabase = window.supabase.createClient(
    'https://jcvjjnxvjyhwkyttncqw.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impjdmpqbnh2anlod2t5dHRuY3F3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzOTA2ODMsImV4cCI6MjA2Nzk2NjY4M30.aNsZLlMts4DQxBAkqXkLi0imYUEMr0OPr9vpGxdYQ70'
  );

  // Show PDF Metadata
  async function showPdfDetails() {
    const { data, error } = await supabase.storage.from('pdf').list('', {
      limit: 1,
      sortBy: { column: 'updated_at', order: 'desc' }
    });

    if (error || !data || !data.length) return;

    const file = data.find(f => f.name === 'latest.pdf');
    if (!file) return;
    
    const size = file.metadata && file.metadata.size ? (file.metadata.size / 1024).toFixed(1) + ' KB' : 'Unknown size';
    
    document.getElementById('pdfDetails').innerHTML = `
      <b>File:</b> ${file.name} <br>
      <b>Size:</b> ${size}
    `;
  }

  // Load PDF viewer and thumbnail
  function loadPdf() {
    const url = `https://jcvjjnxvjyhwkyttncqw.supabase.co/storage/v1/object/public/pdf/latest.pdf`;

    // Set iframe and fallback links
    document.getElementById('pdfFrame').src = url;
    document.getElementById('pdfEmbed').src = url;
    document.getElementById('fallbackLink').href = url;

    // PDF.js thumbnail
    const canvas = document.getElementById('pdfThumb');
    if (window['pdfjsLib'] && window['pdfjsLib'].getDocument) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js';
      pdfjsLib.getDocument(url).promise.then(pdf => {
        pdf.getPage(1).then(page => {
          // Desktop: scale 0.4, Mobile: scale 0.25
          const scale = window.innerWidth <= 600 ? 0.25 : 0.4;
          const viewport = page.getViewport({ scale });
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          page.render({ canvasContext: canvas.getContext('2d'), viewport });
        });
      }).catch(() => {
        canvas.style.display = 'none';
      });
    } else {
      canvas.style.display = 'none';
    }
  }

  // Share Button Setup
  window.onload = function () {
    document.getElementById('shareBtn').onclick = function () {
      if (navigator.share) {
        navigator.share({
          title: document.title,
          text: 'Check out the latest edition of ‡§®‡§µ ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§ï‡•ã‡§®!',
          url: window.location.href
        });
      } else {
        alert('Sharing is not supported in this browser.');
      }
    };

    // Load PDF and Metadata
    showPdfDetails();
    loadPdf();
  };
  </script>
</body>
</html>
